<div class="modal"
     id="exampleModal"
     tabindex="-1"
     role="dialog"
     aria-labelledby="exampleModalLabel"
     aria-hidden="true">
	<div class="modal-dialog"
	     role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title"
				    id="exampleModalLabel">Activate question</h5>
				<button type="button"
				        class="close"
				        data-dismiss="modal"
				        aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<div class="form-group row">
					<label for="questionText"
					       class="col-sm-2 col-form-label">Question:
					</label>
					<div class="col-sm-10">
						<input type="text"
						       class="form-control"
						       id="questionText"
						       disabled>
					</div>
				</div>
				<div class="form-group row">
					<label for="question"
					       class="col-sm-2 col-form-label">Time:
					</label>
					<div class="col-sm-10">
						<input id="time"
						       type="number"
						       value="0"
						       min="5"
						       max="150"
						       step="5">
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button"
				        class="btn btn-secondary"
				        data-dismiss="modal">Cancel
				</button>
				<button type="button"
				        class="btn btn-primary"
				        onclick="activateQuestion()">Confirm
				</button>
			</div>
		</div>
	</div>
</div>

<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.4.1.js"></script>
<script type="text/javascript"
        src="/js/bootstrap-input-spinner.js"></script>

<script type="text/javascript">
  function activateQuestion() {
    let time = parseInt($("#time")[0].value);
    console.log("Time is", time);
    axios.post('/api/question/activate/' + questionToActivate.id)
        .then(response => {
          console.log(response);
          $('#activeQuestion' + questionToActivate.index).prop('checked', true);
          $('#exampleModal').modal('hide');
          console.log(`Question is active for ${time} seconds`);
          disableActivation(true);
          startTimer(time);
        })
        .catch(err => {
          console.log(err);
        });
  }

  function disableActivation(disable) {
    $('.modal-btn').each(function () {
      $(this).prop('disabled', disable);
    });
  }

  function deactivateQuestion(id) {
    axios.post('/api/question/deactivate/' + id)
        .then(response => {
          console.log(response);
        })
        .catch(err => {
          console.log(err);
        });
  }

  function startTimer(duration) {
    let timer = duration, minutes, seconds;
    let timerHtml = $("#timeHeader")[0];

    let interval = setInterval(() => {
      minutes = parseInt(timer / 60)
      seconds = parseInt(timer % 60);

      minutes = minutes < 10 ? "0" + minutes : minutes;
      seconds = seconds < 10 ? "0" + seconds : seconds;
      timerHtml.textContent = `Question "${questionToActivate.text}" is active for ${minutes}:${seconds}`;

      if (--timer < 0) {
        clearInterval(interval);
        timerHtml.textContent = "";
        disableActivation(false);
        deactivateQuestion(questionToActivate.id);
        $('input:checked').prop("checked", false)
      }
    }, 1000);
  }

  function load() {
    $("input[type='number']").InputSpinner();
  }

  document.onload = load();
</script>

